<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fuel Flow Calculator - IO-360-B1B 225hp</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; text-align: center; }
    .container { background: white; display: inline-block; padding: 20px; margin-top: 30px; border-radius: 8px; }
    input { margin: 5px; padding: 5px; width: 100px; }
    button { margin: 10px; padding: 8px 16px; }
    table { margin: 20px auto; border-collapse: collapse; }
    th, td { border: 1px solid #999; padding: 8px 12px; }
    th { background: #ddd; }
  </style>
</head>
<body>
  <h2>Fuel Flow Calculator<br>Lycoming IO-360-B1B (Modified 225hp)</h2>
  <div class="container">
    <div>
      <label>MAP (inHg):</label><br>
      <input id="map" type="number" step="0.1"><br>
    </div>
    <div>
      <label>RPM:</label><br>
      <input id="rpm" type="number" step="10"><br>
    </div>
    <div>
      <label>Altitude (ft):</label><br>
      <input id="alt" type="number" step="100"><br>
    </div>
    <button onclick="calculate()">Calculate</button>
  </div>

  <table id="result" style="display:none;">
    <tr><th>% Power</th><th>HP</th><th>Fuel Flow ROP (L/h)</th><th>Fuel Flow LOP (L/h)</th></tr>
    <tr><td id="pwr"></td><td id="hp"></td><td id="rop"></td><td id="lop"></td></tr>
  </table>

  <script>
    const bsfc = 0.41;
    const hpMax = 225;
    const table = {"2400": {"20.5": 55, "25.1": 75}, "2500": {"20.0": 55, "24.5": 75}, "2600": {"19.5": 55, "23.9": 75}, "2700": {"19.2": 55, "23.4": 75}};
    const lossTable = {"0": 0, "2000": 2, "4000": 4, "6000": 6, "8000": 8, "10000": 12};

    function interp(x, x1, x2, y1, y2) {
      if (x1===x2) return y1;
      return y1 + (y2-y1)*(x-x1)/(x2-x1);
    }

    function getPercentPower(rpm,map) {
      const rpms = Object.keys(table).map(Number).sort((a,b)=>a-b);
      let r1=rpms[0], r2=rpms[rpms.length-1];
      for(let i=0;i<rpms.length;i++) {
        if(rpms[i]<=rpm) r1=rpms[i];
        if(rpms[i]>=rpm){r2=rpms[i]; break;}
      }
      function getPct(r,m) {
        const maps = Object.keys(table[r]).map(Number).sort((a,b)=>a-b);
        let m1=maps[0], m2=maps[maps.length-1];
        for(let j=0;j<maps.length;j++) {
          if(maps[j]<=m) m1=maps[j];
          if(maps[j]>=m){m2=maps[j]; break;}
        }
        return interp(m,m1,m2,table[r][m1],table[r][m2]);
      }
      const p1=getPct(r1,map);
      const p2=getPct(r2,map);
      return interp(rpm,r1,r2,p1,p2);
    }

    function getLoss(alt) {
      const alts = Object.keys(lossTable).map(Number).sort((a,b)=>a-b);
      let a1=alts[0], a2=alts[alts.length-1];
      for(let i=0;i<alts.length;i++) {
        if(alts[i]<=alt) a1=alts[i];
        if(alts[i]>=alt){a2=alts[i]; break;}
      }
      return interp(alt,a1,a2,lossTable[a1],lossTable[a2]);
    }

    function calculate() {
      const map=parseFloat(document.getElementById('map').value);
      const rpm=parseFloat(document.getElementById('rpm').value);
      const alt=parseFloat(document.getElementById('alt').value);

      const pctStock=getPercentPower(rpm,map);
      const loss=getLoss(alt);

      const hpStockCorr = 180*pctStock/100 - loss;
      const hp = hpStockCorr * (225/180);
      const pct = (hp/hpMax)*100;

      const ffRop=hp*bsfc/6*3.785;
      const ffLop=pct<=60?(ffRop*0.9).toFixed(1):"-";

      document.getElementById('pwr').textContent=pct.toFixed(1)+"%";
      document.getElementById('hp').textContent=hp.toFixed(1);
      document.getElementById('rop').textContent=ffRop.toFixed(1);
      document.getElementById('lop').textContent=ffLop;

      document.getElementById('result').style.display="table";
    }
  </script>
</body>
</html>