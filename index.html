<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fuel Flow Calculator - IO-360-B1B 225hp</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f8f8; text-align: center; }
    .container { background: white; display: inline-block; padding: 20px; margin-top: 30px; border-radius: 8px; }
    input { margin: 5px; padding: 5px; width: 100px; }
    button { margin: 10px; padding: 8px 16px; }
    table { margin: 20px auto; border-collapse: collapse; }
    th, td { border: 1px solid #999; padding: 8px 12px; }
    th { background: #ddd; }
  </style>
</head>
<body>
  <h2>Fuel Flow Calculator<br>Lycoming IO-360-B1B (Modified 225hp)</h2>
  <div class="container">
    <div>
      <label>MAP (inHg):</label><br>
      <input id="map" type="number" step="0.1"><br>
    </div>
    <div>
      <label>RPM:</label><br>
      <input id="rpm" type="number" step="10"><br>
    </div>
    <div>
      <label>Altitude (ft):</label><br>
      <input id="alt" type="number" step="100"><br>
    </div>
    <button onclick="calculate()">Calculate</button>
  </div>

  <table id="result" style="display:none;">
    <tr><th>% Power</th><th>HP</th><th>Fuel Flow ROP (L/h)</th><th>Fuel Flow LOP (L/h)</th></tr>
    <tr><td id="pwr"></td><td id="hp"></td><td id="rop"></td><td id="lop"></td></tr>
  </table>

  <script>
    const bsfc = 0.41;
    const hpMax = 225;
    const powerTable = {"2200": {"17": 40, "19": 50, "21": 60, "23": 70, "25": 80}, "2300": {"17": 42, "19": 52, "21": 62, "23": 72, "25": 82}, "2400": {"17": 44, "19": 54, "21": 64, "23": 74, "25": 84}, "2500": {"17": 46, "19": 56, "21": 66, "23": 76, "25": 86}, "2600": {"17": 48, "19": 58, "21": 68, "23": 78, "25": 88}, "2700": {"17": 50, "19": 60, "21": 70, "23": 80, "25": 90}};
    const powerLoss = {"0": 0, "2000": 2, "4000": 4, "6000": 6, "8000": 8, "10000": 12};

    function interpolatePower(rpm, map) {
      const rpms = Object.keys(powerTable).map(Number).sort((a,b)=>a-b);
      let rpmLow = rpms[0], rpmHigh = rpms[rpms.length-1];
      for (let i=0;i<rpms.length;i++) {
        if (rpms[i] <= rpm) rpmLow = rpms[i];
        if (rpms[i] >= rpm) { rpmHigh = rpms[i]; break; }
      }
      if (rpmLow===rpmHigh) return interpolateMap(rpmLow,map);
      const pctLow = interpolateMap(rpmLow,map);
      const pctHigh = interpolateMap(rpmHigh,map);
      return pctLow + (pctHigh-pctLow)*(rpm-rpmLow)/(rpmHigh-rpmLow);
    }

    function interpolateMap(rpm,map) {
      const maps = Object.keys(powerTable[rpm]).map(Number).sort((a,b)=>a-b);
      let mapLow = maps[0], mapHigh = maps[maps.length-1];
      for (let i=0;i<maps.length;i++) {
        if (maps[i] <= map) mapLow = maps[i];
        if (maps[i] >= map) { mapHigh = maps[i]; break; }
      }
      if (mapLow===mapHigh) return powerTable[rpm][mapLow];
      const pctLow = powerTable[rpm][mapLow];
      const pctHigh = powerTable[rpm][mapHigh];
      return pctLow + (pctHigh-pctLow)*(map-mapLow)/(mapHigh-mapLow);
    }

    function interpolateLoss(alt) {
      const alts = Object.keys(powerLoss).map(Number).sort((a,b)=>a-b);
      let altLow = alts[0], altHigh = alts[alts.length-1];
      for (let i=0;i<alts.length;i++) {
        if (alts[i] <= alt) altLow = alts[i];
        if (alts[i] >= alt) { altHigh = alts[i]; break; }
      }
      if (altLow===altHigh) return powerLoss[altLow];
      const lossLow = powerLoss[altLow];
      const lossHigh = powerLoss[altHigh];
      return lossLow + (lossHigh-lossLow)*(alt-altLow)/(altHigh-altLow);
    }

    function calculate() {
      const map = parseFloat(document.getElementById('map').value);
      const rpm = parseFloat(document.getElementById('rpm').value);
      const alt = parseFloat(document.getElementById('alt').value);

      let pctStock = interpolatePower(rpm,map);
      const lossHp = interpolateLoss(alt);
      const hpStock = 180 * pctStock / 100 - lossHp;
      const pctCorrected = hpStock / 180 * 100;

      const hp = hpMax * pctCorrected / 100;
      const ffRop = hp * bsfc / 6 * 3.785;
      const ffLop = pctCorrected <= 60 ? (ffRop * 0.9).toFixed(1) : "-";

      document.getElementById('pwr').textContent = pctCorrected.toFixed(1) + "%";
      document.getElementById('hp').textContent = hp.toFixed(1);
      document.getElementById('rop').textContent = ffRop.toFixed(1);
      document.getElementById('lop').textContent = ffLop;

      document.getElementById('result').style.display = "table";
    }
  </script>
</body>
</html>